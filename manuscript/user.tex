% !TeX root = ./thesis.tex
\usepackage{mathtools}
\usepackage{tipa}
\usepackage{bm}
\usepackage{physics}
\usepackage[normalem]{ulem}
\usepackage{pythonhighlight}
\usepackage{mdframed}
\usepackage{wrapfig}

% Definitions of math symbols etc.
\usepackage{xspace}
\input{tex/definitions}

% Plots (PGF and PDF)
\usepackage{pgf}
\DeclareUnicodeCharacter{2212}{-} % Needed for matplotlib's pgf output

% Skip slow PGF compilation in draft mode: https://github.com/nilsvu/texfig
\usepackage{ifdraft}
\newcommand{\plotpgf}[1]{\ifdraft{\includegraphics{#1.pdf}}{\input{#1.pgf}}}

\newcommand{\centeroverfull}[1]{%
  \centering\makebox[0pt]{#1} % https://tex.stackexchange.com/a/203973/193011
}

\newcommand{\centerpgf}[1]{\centeroverfull{\plotpgf{#1}}}

\newcommand{\centeredfigure}[3]{%
  \begin{figure}[t]
    \centering
    \includegraphics{figures/#1.pdf}
    \caption{\textbf{#2}%
    {#3} \label{fig:#1}}
  \end{figure}
}

% Epigraph
\usepackage{epigraph}

\newcommand{\citedepigraph}[3]{%
  \epigraph{{#1}}{\footnotesize\nocite{#3}\hyperlink{cite.#3}{{#2}}}%
}

% Custom `localtoc' environment
\usepackage[titletoc,title]{appendix} % https://tex.stackexchange.com/a/305164/193011
\usepackage{titletoc}

% https://tex.stackexchange.com/a/600/193011
\def\changemargin#1#2{\list{}{\rightmargin#2\leftmargin#1}\item[]}
\let\endchangemargin=\endlist

\newenvironment{localtoc}[1] 
{%
\setcounter{tocdepth}{1}
\startcontents
%
\begin{changemargin}{1.5cm}{1.5cm} 
\hrulefill
\vspace{-.8\baselineskip}
\footnotesize\singlespacing
#1%
\noindent\printcontents{}{1}{}
\vskip-8pt\noindent\hrulefill
\end{changemargin}
}
{%
\stopcontents
}

\newenvironment{chaptersections}[1] {\begin{localtoc}{#1}}{\end{localtoc}}

% Argument [1] is `i' in current Chapter label `chapter:i'
\newcount\chaptercounter
\newenvironment{chapterappendices}[1]
{%
\begin{subappendices}
\begin{localtoc}{%
\chaptercounter #1\relax
\advance\chaptercounter +1\relax
The next chapter starts on \hyperref[chapter:\the\chaptercounter]{\bf p.~\pageref{chapter:\the\chaptercounter}}.
More details in the following appendices:
}
}
{%
\end{localtoc}
\end{subappendices}
}

% Shloppy
\newcommand{\shloppy}[1]{\textcolor{purple}{\texttt{<sloppy>}}~#1~\textcolor{purple}{\texttt{</sloppy>}}}

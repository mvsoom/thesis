#!/usr/bin/env bash
set -euo pipefail

# usage:
#   run_notebook.sh path/to/file.(R|py|...)

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 file"
    exit 1
fi

SRC="$1"

if [ ! -f "$SRC" ]; then
    echo "File not found: $SRC"
    exit 1
fi

EXT="${SRC##*.}"
BASE="${SRC%.*}"

IPYNB="${BASE}.ipynb"
OUT="${BASE}.executed.ipynb"

# select kernel
case "$EXT" in
    R|r)
        KERNEL="ir"
        ;;
    *)
        KERNEL="python3"
        ;;
esac

echo "[1/3] Converting -> ipynb with jupytext..."
jupytext --to notebook "$SRC"

echo "[2/3] Executing with papermill (kernel=$KERNEL)..."
papermill "$IPYNB" "$OUT" -k "$KERNEL"

echo "[3/3] Done."
echo "Output: $OUT"
